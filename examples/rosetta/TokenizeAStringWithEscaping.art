tokenize [s,sep,esc]{
	escaping 0
	loop $(range 0 $(size s)-1) [i]{
		chr $(get $(characters s) i) 

		if escaping=1 {
			print chr true
			escaping 0
		} {
			if chr=sep {
				print ""

			} {
				if chr=esc {
					escaping 1
				} {
					print chr true
				}
			}
		}
	}
	print ""
}

str "one^|uno||three^^^^|four^^^|^cuatro|" 
print $(tokenize str "|" "^")
