;; Library: Files -- https://arturo-lang.io/documentation/library/files/
;;
;; This file tests Arturo's Files Library
;; for obvious reasons, bash is used as helper to this,
;; doing functions independents of each other.


topic: $[topic :string] [
    print ""
    print ~">> |topic|"
    print ""
]

execute "mkdir temp"
print "Created: temp/"

; ---------------------------- Functions ----------------------------

; -- Test: copy

topic "copy"
do [

    ; preparing
    execute "mkdir temp/toCopy"
    ; Using write because I can't redirect using `execute` function
    write "temp/toCopy/file.txt" "Hello, world!"

    ; action
    copy "temp/toCopy/file.txt" "temp/copied.txt"

    ; assertion
    print execute "cat temp/copied.txt"

    ; cleaning
    execute "rm temp/* --recursive"

]


topic "copy.directory - with empty folders"
do [

    ; preparing
    execute "mkdir temp/toCopy"
    execute "mkdir temp/toCopy/folder{A,B,C}"
    execute "mkdir temp/toCopy/folder{A,B,C}/{A,B,C}"
    execute "mkdir temp/dest"

    ; action
    copy.directory "temp/toCopy/" "temp/dest"

    ; assertion
    print execute "ls temp/dest/**"

    ; cleaning
    execute "rm temp/* --recursive"

]

topic "copy.directory - with mixed folders"
do [

    ; preparing

    execute "mkdir temp/toCopy"
    execute "mkdir temp/toCopy/folder{A,B,C}"
    execute "mkdir temp/toCopy/folder{A,B,C}/{A,B,C}"

    write "temp/toCopy/folderA/A/file.txt" "Hello, world!"
    write "temp/toCopy/folderB/B/file.txt" "Hello, world!"
    write "temp/toCopy/folderC/C/file.txt" "Hello, world!"
    write "temp/toCopy/folderA/file.txt" "Hello, world!"
    write "temp/toCopy/file.txt" "Hello, world!"

    execute "mkdir temp/dest"

    ; action
    copy.directory "temp/toCopy/" "temp/dest"

    ; assertion
    print execute "ls temp/dest/** --recursive"

    ; cleaning
    execute "rm temp/* --recursive"

]


; -- Test: delete

topic "delete"
do [

    ; preparing
    ; Using write because I can't redirect using `execute` function
    write "temp/file.txt" "Hello, world!"

    ; 1st assertion
    print execute "cat temp/file.txt"

    ; action
    print "deleting..."
    delete "temp/file.txt"

    ; 2nd assertion
    print execute "cat temp/file.txt"

    ; cleaning
    execute "rm temp/* --recursive"

]

topic "delete.directory - with empty folders"
do [

    ; preparing
    execute "mkdir temp/folder{A,B,C}"
    execute "mkdir temp/folder{A,B,C}/{A,B,C}"

    ; assertion
    print execute "ls temp/**"

    ; action
    print "Deleting..."
    delete.directory "temp/folderA"
    delete.directory "temp/folderB"
    delete.directory "temp/folderC"

    ; assertion
    print ["now:" execute "ls temp"]

    ; cleaning
    execute "rm temp/* --recursive"

]

; -- Test: move

; -- Test: permissions

; -- Test: read

; -- Test: rename

; -- Test: symlink

; -- Test: timestamp

; -- Test: unzip

; -- Test: volume

; -- Test: write

; -- Test: zip

; -- exists?

; -- hidden?


; ---- Finish
execute "rmdir temp"
